{% extends "layout.html" %}

{% block title %}Upload Fundus Image{% endblock %}

{% block content %}
<div class="row justify-content-center">
  <div class="col-md-8">
    <div class="card">
      <div class="card-header text-center">
        <h4>Upload Fundus Image</h4>
      </div>
      <div class="card-body">
        <form id="uploadForm" method="post" action="/upload" enctype="multipart/form-data">
          <div class="mb-3">
            <label for="fileInput" class="form-label">Choose Image or DICOM File</label>
            <div id="dropZone" class="file-input">
                Drag and drop a file here or click to select
            </div>
            <input id="fileInput" type="file" name="file" class="form-control d-none">
            <div id="errorContainer" class="error-message"></div>
            <div id="fileNameDisplay" class="text-muted mt-2" style="display:none;"></div>
        </div>
        <div id="previewContainer" class="mt-3" style="display:none;">
            <img id="imagePreview" src="#" alt="Preview" class="img-fluid rounded" style="max-height:300px;">
            <div id="dicomNotice" class="text-muted"></div>
        </div>

          <div class="mb-3">
            <label for="modelSelect" class="form-label">Select AI Model</label>
            <select id="modelSelect" name="model" class="form-select">
            <option disabled selected>Loading models...</option>
            </select>
          </div>

          <div id="metadataFields" style="display:none; margin-top:20px;">
            <div class="mb-3">
              <label for="mrn" class="form-label">Medical Record Number (MRN)</label>
              <input id="mrnInput" type="text" class="form-control" name="mrn">
            </div>
            <div class="mb-3">
              <label for="age" class="form-label">Age</label>
              <input type="number" class="form-control" name="age" min="0" max="120">
            </div>
            <div class="mb-3">
              <label for="gender" class="form-label">Gender</label>
              <select class="form-select" name="gender">
                <option value="Unknown">Unknown</option>
                <option value="M">Male</option>
                <option value="F">Female</option>
                <option value="O">Other</option>
              </select>
            </div>
            <div class="mb-3">
              <label for="eye" class="form-label">Eye</label>
              <select class="form-select" name="eye">
                <option value="Unknown">Unknown</option>
                <option value="RIGHT">Right Eye</option>
                <option value="LEFT">Left Eye</option>
              </select>
            </div>
            <div class="mb-3">
              <label for="study_date" class="form-label">Study Date</label>
              <input type="date" class="form-control" name="study_date">
            </div>
          </div>

          <div class="text-center">
            <button id="uploadBtn" type="submit" class="btn btn-primary" disabled>Upload and Analyze</button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>
{% endblock %}
